(function(){if(window.mxticker){return}function o(t){var s,u=new RegExp("(^| )"+t+"=([^;]*)(;|$)");if(s=document.cookie.match(u)){return unescape(s[2])}else{return null}}function k(t,u){var s=new Date();s.setTime(s.getTime()+30*24*60*60*1000);document.cookie=t+"="+escape(u)+";expires="+s.toGMTString()}function a(s,t){if(window.localStorage){localStorage.setItem(s,t)}k(s,t)}function j(s){var t=null;if(window.localStorage){t=localStorage.getItem(s)}if(!t){t=o(s)}return t}var i=window.location.href;var q=sessionStorage.getItem("localrefs");if(q){q=q.split("$$$$$$");if(q[q.length-1]==i){q.pop();sessionStorage.setItem("localrefs",q.join("$$$$$$"))}}var e=false;window.onunload=window.onbeforeunload=function(){if(e){return}e=true;var s=sessionStorage.getItem("localrefs");var t=[];if(s){t=s.split("$$$$$$")}t.push(i);if(t.length>2){t.shift()}sessionStorage.setItem("localrefs",t.join("$$$$$$"))};function d(s){var u={};var x=s.split("#");var A=x[0];var w=x[1];if(A){var y=A.split("?");if(y[1]){var z=y[1].split("&");for(var v=0;v<z.length;v++){u[z[v].split("=")[0]]=unescape(z[v].split("=")[1])}}}if(w){var t=w.split("?");if(t[1]){var z=t[1].split("&");for(var v=0;v<z.length;v++){u[z[v].split("=")[0]]=unescape(z[v].split("=")[1])}}else{if(t[0].indexOf("=")>0){var z=t[0].split("&");for(var v=0;v<z.length;v++){u[z[v].split("=")[0]]=unescape(z[v].split("=")[1])}}}}return u}var h={};function c(s){if(h[s]){return h[s]}var v=d(window.location.href);var u={};for(var t in v){if(t&&t.indexOf(s)===0){u[t.replace(s,"")]=v[t]}}h[s]=u;return u}function l(){var s=localStorage.getItem("mxticker_data");return s?JSON.parse(s):null}function b(s){var t=o("tid");if(t){s.tid=t}localStorage.setItem("mxticker_data",JSON.stringify(s))}var f=null;var m={pageInitStart:+(new Date()),clearCachedTickData:function(){var t=l();if(t){if(f){window.clearTimeout(f)}var s=+(new Date());t.c_t_offset=Math.floor((s-t.t)/1000);t.ts_offset=Math.floor((s-t.t));t.t=s;(new Image()).src=this.getTickUrl(t);localStorage.removeItem("mxticker_data")}},tick:function(t){var s=this;t=this.prepareData(t);this.clearCachedTickData();b(t);f=window.setTimeout(function(){s.clearCachedTickData()},7*1000)},getTickUrl:function(t){var u=[];for(var s in t){u.push(s+"="+window.encodeURIComponent(t[s]))}return this.config.api+"?"+u.join("&")},prepareData:function(w){w=w||{};if(typeof this.config.beforePrepareData=="function"){try{var F=this.config.beforePrepareData(w,this);if(F){w=F}}catch(A){}}w.av=this.config.av||1;w.as=this.config.as||3;w.bu_id=this.config.bu_id;if(!w.city_id&&this.config.getCityID){try{w.city_id=this.config.getCityID()}catch(A){}}if(!w.uid&&this.config.getUserID){try{w.uid=this.config.getUserID()}catch(A){}}if(!w.area_id&&this.config.getAreaID){try{w.area_id=this.config.getAreaID()}catch(A){}}if(!w.url){var x=window.location.hash;if(false&&x&&x!="#"){w.url=x}else{w.url=window.location.href}}if(!w.c_t_offset){w.c_t_offset=0}var v=d(w.url);w.url=this.prepareUrl(w.url);var s=d(w.url);for(var y in s){if(s.hasOwnProperty(y)){v[y]=s[y]}}w.referrer=this.prepareUrl(w.referrer);if(!w.type){w.type=1}if(!w.spm){w.spm=v.spm||v.__analytics__spm||""}if(w.params){if(w.params.constructor==Array){w.params=w.params.join("$")}}if(v.__analytics__device_id){w.device_id=v.__analytics__device_id;a("device_id",w.device_id);delete v.__analytics__device_id}else{var C=j("device_id");if(C){w.device_id=C}}if(v.__analytics__as){w.as=v.__analytics__as;a("as",w.as);delete v.__analytics__as}else{var u=j("as");if(u){w.as=u}}if(v.__analytics__referrer){w.referrer=v.__analytics__referrer}var z=[];for(var D in v){if(v.hasOwnProperty(D)){z.push(D+":"+v[D])}}if(z.length){if(w.params){w.params=w.params+"$"+z.join("$")}else{w.params=z.join("$")}}if(w.spm&&w.spm.indexOf("m.")===0){var B=w.spm.split(".")[1];if(w.params){w.params=w.params+"$p_cms_id:"+B}else{w.params="p_cms_id:"+B}}w.t=+(new Date());if(!window.screen_sc&&window.screen&&window.screen.width&&window.screen.height){window.screen_sc=window.screen.width+"*"+window.screen.height}if(window.screen_sc){w.sc=window.screen_sc}var t=c("__analytics__");if(t){for(var E in t){w[E]=t[E]}}return w}};var g={init:function(s){this.config(s||{});this.pvStat();return this},config:function(s){m.prepareUrl=function(t){if(t.indexOf("#!/")>-1){t=window.location.origin+t.split("#!")[1]}if(s.prepareUrl){return s.prepareUrl(t)}else{return t}};m.config=s;return this},tick:function(t){try{t=t||{};var s=t.type;if(!s||s==1){t.referrer=this.getRefer()}else{t.referrer=window.location.href}m.tick(t)}catch(u){console.log("打点发送失败");console.log(u);console.log(t)}return this},addHistory:function(s){s=s||window.location.href;if(!this.urls){this.urls=[]}if(this.urls.length>5){this.urls.shift()}this.urls.push(s)},getRefer:function(){if(!this.urls||this.urls.length<2){var s=document.referrer;var t=sessionStorage.getItem("localrefs");if(t){t=t.split("$$$$$$");return t[t.length-1]}return s}else{return this.urls[this.urls.length-2]}},pvStat:function(){var t=this;t.pvTick();window.addEventListener("hashchange",function(){t.pvTick()});if(window.history&&(typeof window.history.pushState=="function")){var s=window.history.pushState;window.history.pushState=function(){s.apply(history,arguments);window.setTimeout(function(){t.pvTick()},0)};window.addEventListener("popstate",function(){window.setTimeout(function(){t.pvTick()},0)})}return t},pvTickTime:0,pvTick:function(){if(Math.abs(this.pvTickTime-(+new Date()))<500){return this}else{this.pvTickTime=+(new Date())}this.addHistory();this.tick()}};if(window.$){var p=function(s){var u=[];for(var t=0;t<s.length;t++){var v=s[t]["nodeName"];if(v.indexOf("param-")===0){u.push(v.replace("param-","")+":"+s[t]["value"])}}return u};$("body").delegate("[spm]","click",function(x){var v="coord:"+[Math.floor(x.x),Math.floor(x.y)].join();var s=$(this);var w=s.attr("spm");if(w){var y;if(w.indexOf("m")===0){y={type:1};var u=s.attr("href");if(u&&u.indexOf("javascript")!==0&&u.indexOf("#")!==0){if(u.indexOf("?")>-1||u.indexOf("#")>0){s.attr("href",u+"&spm="+w)}else{s.attr("href",u+"?spm="+w)}}else{if(u&&(u.indexOf("#+good_id=")>-1||u.indexOf("#good_id=")>-1)){s.attr("href",u+"&spm="+w);return}else{y={type:2};y.params=p(s.get(0).attributes);y.params.push(v);if(w.split(".").length<4){var t=s.closest(".spm-unit");if(t.length){w+="."+t.index()}else{w+=".0"}}y.spm=w;g.tick(y)}}}else{y={type:2};y.params=p(s.get(0).attributes);y.params.push(v);if(w.split(".").length<4){var t=s.closest(".spm-unit");if(t.length){w+="."+t.index()}else{w+=".0"}}y.spm=w;g.tick(y)}}})}var n=false;var r;document.body.addEventListener("touchstart",function(s){},false);document.body.addEventListener("touchmove",function(s){n=true},false);document.body.addEventListener("touchend",function(t){if(n){n=false;if(t.changedTouches&&t.changedTouches.length){var s=t.changedTouches[0];if(r){window.clearTimeout(r)}r=window.setTimeout(function(){var u=$(t.target).closest("[spm],[_spm],[spm_show]");var v={type:3,params:"coord:"+[Math.floor(s.pageX),Math.floor(s.pageY)].join(),spm:u.attr("spm")||u.attr("_spm")||u.attr("spm_show")||""};g.tick(v)},500)}}},false);document.addEventListener("visibilitychange",function(){if(document.visibilityState=="hidden"){m.clearCachedTickData()}});window.mxticker=g})();
